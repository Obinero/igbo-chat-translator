
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Igbo ↔ English Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; margin: 0; display: flex; flex-direction: column; height: 100vh; }
    header { background-color: #0466c8; color: white; text-align: center; padding: 1rem; font-size: 1.5rem; }
    #language-toggle { padding: 0.5rem; margin: 1rem auto; font-size: 1rem; }
    #chat { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
    .bubble { padding: 0.75rem; border-radius: 0.75rem; max-width: 75%; line-height: 1.5; }
    .user { align-self: flex-end; background-color: #d0e8ff; }
    .bot { align-self: flex-start; background-color: #fff; border: 1px solid #ccc; }
    #form { display: flex; padding: 1rem; background: white; border-top: 1px solid #ccc; }
    #input { flex: 1; padding: 0.5rem; font-size: 1rem; }
    button { background: #0466c8; color: white; border: none; padding: 0 1rem; cursor: pointer; }
    .speak-btn { margin-top: 0.5rem; background: #28a745; color: white; border: none; padding: 0.3rem 0.6rem; cursor: pointer; }
  </style>
</head>
<body>
  <header>Igbo ↔ English Chat Translator</header>
  <select id="language-toggle">
    <option value="en-to-ig">English to Igbo</option>
    <option value="ig-to-en">Igbo to English</option>
  </select>
  <div id="chat"></div>
  <form id="form">
    <input id="input" type="text" placeholder="Type something..." required />
    <button type="submit">Send</button>
  </form>
  <script>
    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const input = document.getElementById("input");
    const langToggle = document.getElementById("language-toggle");
    let chatHistory = [];

    function speak(text, lang) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      speechSynthesis.speak(utterance);
    }

    async function sendMessage(userMessage) {
      const userBubble = document.createElement("div");
      userBubble.className = "bubble user";
      userBubble.innerText = userMessage;
      chat.appendChild(userBubble);
      input.value = "";

      const botBubble = document.createElement("div");
      botBubble.className = "bubble bot";
      botBubble.innerText = "Translating...";
      chat.appendChild(botBubble);
      chat.scrollTop = chat.scrollHeight;

      let systemPrompt = "";
      let speakLang = "ig-NG";

      if (langToggle.value === "en-to-ig") {
        systemPrompt = "You are an Igbo language teacher. Translate English to Igbo and give a brief explanation.";
        speakLang = "ig-NG";
      } else {
        systemPrompt = "You are an English tutor. Translate Igbo to English and give a brief explanation.";
        speakLang = "en-US";
      }

      try {
        const response = await fetch("/.netlify/functions/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userMessage, systemPrompt, chatHistory }),
        });

        const data = await response.json();
        const reply = data.reply;
        const output = reply.split("Explanation:")[0].split("Igbo:").pop().split("English:").pop().trim();

        botBubble.innerHTML = `
          <div>${reply}</div>
          <button class="speak-btn" onclick="speak('${output.replace(/'/g, "\'")}', '${speakLang}')">🔊 Listen</button>
        `;

        chatHistory.push({ role: "user", content: userMessage });
        chatHistory.push({ role: "assistant", content: reply });
        chat.scrollTop = chat.scrollHeight;
      } catch (error) {
        botBubble.innerText = "⚠️ Error: Could not connect to server.";
      }
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const message = input.value.trim();
      if (message) sendMessage(message);
    });
  </script>
</body>
</html>
